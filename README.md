# Spotify Readme

A fork of a popular Spotify currently playing widget. Cleaned up and added a phrase for your daylist and a click through to redirect to last playing song.

There used to be a simple way of getting the day list which was to fetch the user's current playlists and iterate until you find the daylist. But since [November 27th, 2024](https://developer.spotify.com/blog/2024-11-27-changes-to-the-web-api) Spotify has removed the ability to look up their curated generative playlists across all of their official endpoints.

This new implementation uses Playwright to sign in, search for the daylist, and grab the title from the Web app. It runs a cron job as an action every hour to update the daylist. We then fetch the artifact it generates using [nightly.link](https://nightly.link) and get the title from it. This is quite brittle and dependent on a cookie generated by an offline run (`uv run scripts/get_refresh_token.py`) and then setting it `cat app/.spotify_cookies.json | jq -c '.' | gh secret set SPOTIFY_COOKIES`.

## Preview

```
/svg
```

![Preview](https://spotify.jackson.gd/svg)

```
/link
```

[Link to the song](https://spotify.jackson.gd/link)

```
/daylist
/daylist/light
/daylist/dark
```

![Daylist](https://spotify.jackson.gd/daylist)

## Required variables for GitHub Actions

- `REFRESH_TOKEN`
- `CLIENT_ID`
- `CLIENT_SECRET`
- `SPOTIFY_COOKIES`

## Required variables for your server

- `REFRESH_TOKEN`
- `CLIENT_ID`
- `CLIENT_SECRET`